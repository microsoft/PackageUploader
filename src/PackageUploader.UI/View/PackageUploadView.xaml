<?xml version="1.0" encoding="utf-8" ?>
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewmodel="clr-namespace:PackageUploader.UI.ViewModel"
             xmlns:converters="clr-namespace:PackageUploader.UI.Converters"
             xmlns:controls="clr-namespace:PackageUploader.UI.Controls"
             x:Class="PackageUploader.UI.View.PackageUploadView"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=viewmodel:PackageUploadViewModel}">

    <UserControl.Resources>
        <ResourceDictionary>
            <converters:StringNotEmptyConverter x:Key="StringNotEmptyConverter" />
            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer>
        <Grid Margin="30,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
                   x:Name="SubHeadLine"
                   Text="Upload your package to Partner Center"
                   Style="{StaticResource SubHeadline}" />

            <StackPanel Grid.Row="1" Orientation="Vertical" HorizontalAlignment="Center">
                <TextBlock Text="{Binding SuccessMessage}" 
                       Foreground="{StaticResource PrimaryBrush}"
                       Style="{StaticResource SubHeadline}"
                       HorizontalAlignment="Center"
                       Visibility="{Binding SuccessMessage, Converter={StaticResource StringNotEmptyConverter}, ConverterParameter=Visibility}" />
                
                <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="Red"
                       Style="{StaticResource SubHeadline}"
                       HorizontalAlignment="Center"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}, ConverterParameter=Visibility}" />
            </StackPanel>

            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ProgressBar
                    Grid.Row="0"
                    x:Name="WorkingIndicator"
                    IsIndeterminate="{Binding IsSpinnerRunning, Mode=OneWay}"
                    Height="20"
                    Width="200"
                    HorizontalAlignment="Center" />

                <ProgressBar
                    Grid.Row="1"
                    Value="{Binding ProgressValue, Mode=OneWay}"
                    Visibility="{Binding IsProgressVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Foreground="Green"
                    HorizontalAlignment="Stretch"
                    Margin="200,20,200,0"
                    Height="25"/>
            </Grid>

            <!-- Package Drop Area  -->
            <Grid Grid.Row="3" Visibility="{Binding IsDragDropVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <controls:DropArea 
                    Message="{Binding DragDropMessage}"
                    FileDroppedCommand="{Binding FileDroppedCommand}"
                    BrowseCommand="{Binding BrowseForPackageCommand}"
                    AcceptedExtensions=".xvc,.msixvc"
                    Height="100"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center" />
            </Grid>

            <!-- Package Selected Info -->
            <Grid Grid.Row="3" Visibility="{Binding HasPackage, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" 
                       Text="Selected Package" 
                       Style="{StaticResource SubHeadline}" 
                       HorizontalAlignment="Left" />
                       
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" 
                           Text="{Binding PackageFilePath}" 
                           TextTrimming="CharacterEllipsis"
                           VerticalAlignment="Center" />
                           
                    <Button Grid.Column="1" 
                            Content="Reset" 
                            Command="{Binding ResetPackageCommand}"
                            Width="100" 
                            HorizontalAlignment="Right" />
                </Grid>
            </Grid>

            <Grid Grid.Row="4" Visibility="{Binding HasPackage, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                       Text="Package Uploader Parameters"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       Style="{StaticResource SubHeadline}" />

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- First Column - First 4 parameters -->
                    <Grid Grid.Column="0" Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="StoreId / BigID"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <TextBox Grid.Column="1"
                               x:Name="bigId"
                               Text="{Binding BigId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <TextBlock Text="Enter bigId" 
                                                                   Foreground="Gray" 
                                                                   Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="5,2"/>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                     Margin="5,2" 
                                                                     VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>

                    <Grid Grid.Column="0" Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Select Mode"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <ComboBox Grid.Column="1"
                                x:Name="modePicker"
                                ItemsSource="{Binding Modes, Mode=OneWay}"
                                SelectedItem="{Binding SelectedMode, Mode=TwoWay}" />
                    </Grid>

                    <Grid Grid.Column="0" Grid.Row="2" Visibility="{Binding IsBranchSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Branch"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <ComboBox Grid.Column="1"
                                x:Name="branchFriendlyName"
                                ItemsSource="{Binding BranchFriendlyNames, Mode=OneWay}"
                                SelectedItem="{Binding BranchFriendlyName, Mode=TwoWay}" />
                    </Grid>

                    <Grid Grid.Column="0" Grid.Row="2" Visibility="{Binding IsFlightSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Flight"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <ComboBox Grid.Column="1"
                                x:Name="flightName"
                                ItemsSource="{Binding FlightNames, Mode=OneWay}"
                                SelectedItem="{Binding FlightName, Mode=TwoWay}" />
                    </Grid>

                    <Grid Grid.Column="0" Grid.Row="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Market Group"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <ComboBox Grid.Column="1"
                                x:Name="marketGroupName"
                                ItemsSource="{Binding MarketGroupNames, Mode=OneWay}"
                                SelectedItem="{Binding MarketGroupName, Mode=TwoWay}" />
                    </Grid>

                    <!-- Second Column - Other 4 parameters -->
                    <Grid Grid.Column="1" Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Package Path"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <TextBox Grid.Column="1"
                               x:Name="packageFilePath"
                               Text="{Binding PackageFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <TextBlock Text="Enter packageFilePath" 
                                                                   Foreground="Gray" 
                                                                   Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="5,2"/>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                     Margin="5,2" 
                                                                     VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>

                    <Grid Grid.Column="1" Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="EKB File"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <TextBox Grid.Column="1"
                               x:Name="ekbFilePath"
                               Text="{Binding EkbFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <TextBlock Text="Enter ekbFilePath" 
                                                                   Foreground="Gray" 
                                                                   Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="5,2"/>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                     Margin="5,2" 
                                                                     VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>

                    <Grid Grid.Column="1" Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Validator Log"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <TextBox Grid.Column="1"
                               x:Name="subValFilePath"
                               Text="{Binding SubValFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <TextBlock Text="Enter subValFilePath" 
                                                                   Foreground="Gray" 
                                                                   Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="5,2"/>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                     Margin="5,2" 
                                                                     VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>
                    <Grid Grid.Column="1" Grid.Row="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width=".3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                               Text="Symbol Bundle"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left" />
                        <TextBox Grid.Column="1"
                               x:Name="symbolBundleFilePath"
                               Text="{Binding SymbolBundleFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}">
                                                    <Grid>
                                                        <TextBlock Text="Enter symbolBundleFilePath" 
                                                                   Foreground="Gray" 
                                                                   Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="5,2"/>
                                                        <ScrollViewer x:Name="PART_ContentHost" 
                                                                     Margin="5,2" 
                                                                     VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>
                </Grid>
            </Grid>

            <Grid Grid.Row="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Margin="5"
                        x:Name="UploadPackage"
                        Content="Upload Package" 
                        Command="{Binding UploadPackageCommand}"
                        IsEnabled="{Binding HasPackage}"
                        HorizontalAlignment="Stretch" />

                <Button Grid.Column="1"
                        Margin="5"
                        x:Name="CancelUpload"
                        Content="Cancel Upload" 
                        Command="{Binding CancelUploadCommand}"
                        IsEnabled="{Binding IsUploadInProgress}"
                        HorizontalAlignment="Stretch" />
            </Grid>
        </Grid>
    </ScrollViewer>

</UserControl>
