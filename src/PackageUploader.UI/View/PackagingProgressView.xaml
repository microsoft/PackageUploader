<?xml version="1.0" encoding="utf-8" ?>
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             x:Class="PackageUploader.UI.View.PackagingProgressView"
             xmlns:viewmodel="clr-namespace:PackageUploader.UI.ViewModel"
             xmlns:converters="clr-namespace:PackageUploader.UI.Converters"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=viewmodel:PackagingProgressViewModel}"
             Background="#25282C">                                       
    <UserControl.Resources>
        <converters:ProgressToVisibilityConverter x:Key="ProgressToVisibilityConverter" />
        <Storyboard x:Key="RotateAnimation">
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                From="0"
                To="360"
                Duration="0:0:5"
                RepeatBehavior="Forever" />
        </Storyboard>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <!-- picture -->
            <RowDefinition Height="Auto"/>
            <!-- heading -->
            <RowDefinition Height="Auto"/>
            <!-- progress bars bundle-->
            <RowDefinition Height="Auto"/>
            <!-- updating labels -->
            <RowDefinition Height="Auto"/>
            <!-- cancel button? -->
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Image Grid.Row="0"
               Margin="0, 100, 0, 23"
               Source="/Resources/Images/InProgress.png"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Height="130"
               Width="130"
               Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}"/>
        <Image Grid.Row="0"
               Margin="0, 100, 0, 23"
               Source="/Resources/Images/ErrorImage.png"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Height="130"
               Width="130"
               Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}"/>
        <TextBlock Grid.Row="1"
                   Margin="0, 0, 0, 23"
                   Style="{StaticResource SubHeadline}"
                   Text="Getting your package ready..."
                   Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}"
                   Foreground="White" />
        <TextBlock Grid.Row="1"
                   Margin="0, 0, 0, 23"
                   Style="{StaticResource SubHeadline}"
                   Text="We've run into an issue, go back to fix"
                   Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}"
                   Foreground="White" />
        <!-- Loading Bar -->
        <Grid Grid.Row="2"
              Margin="300, 0, 300, 23">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Row="0"
                       Grid.Column="0"
                       Margin="0, 0, 0, 10"
                       Text="Packaging..."
                       Foreground="White" 
                       HorizontalAlignment="Left"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}"/>
            <TextBlock Grid.Row="0"
                       Grid.Column="0"
                       Margin="0, 0, 0, 10"
                       Text="Packaging stopped"
                       Foreground="White" 
                       HorizontalAlignment="Left"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}"/>
            <StackPanel Grid.Row="0"
                        Grid.Column="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <TextBlock Text="{Binding PackingProgressPercentage, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                           Foreground="White"/>
                <TextBlock Text="% complete"
                           Foreground="White" />
            </StackPanel>
            <ProgressBar Grid.Row="1"
                         Grid.ColumnSpan="2"
                         Margin="0, 0, 0, 23"
                         Minimum="0"
                         Maximum="100"
                         Value="{Binding PackingProgressPercentage}"
                         Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}"
                         Foreground="{StaticResource LightPurplishBlueBrush}"
                         Background="{StaticResource Gray500Brush}"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         Height="3"/>
            <ProgressBar Grid.Row="1"
                         Grid.ColumnSpan="2"
                         Margin="0, 0, 0, 23"
                         Minimum="0"
                         Maximum="100"
                         Value="{Binding PackingProgressPercentage}"
                         Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}"
                         Foreground="Red"
                         Background="{StaticResource Gray500Brush}"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         Height="3"/>
        </Grid>
        <!-- updating labels -->
        <Grid Grid.Row="3" Margin="500, 0, 0, 0">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="28" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <!-- Row 1 -->
            <Grid Grid.Row="0"
                  Grid.Column="0"
                  Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=0-5}"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Height="16"
                  Width="16">
                <Image Source="/Resources/AppIcon/Settings.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}">
                    <Image.RenderTransform>
                        <RotateTransform CenterX="8" CenterY="8" />
                    </Image.RenderTransform>
                    <Image.Triggers>
                        <EventTrigger RoutedEvent="Image.Loaded">
                            <BeginStoryboard Storyboard="{StaticResource RotateAnimation}" />
                        </EventTrigger>
                    </Image.Triggers>
                </Image>
                <Image Source="/Resources/AppIcon/ErrorIcon.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </Grid>
            <Image Grid.Row="0"
                   Grid.Column="0"
                   Source="/Resources/AppIcon/Accept.png"
                   Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=6-100}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Top"
                   Height="16"
                   Width="16"/>
            <TextBlock Grid.Row="0"
                       Grid.Column="1"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       Text="Validating files..."
                       Foreground="White"/>
            <StackPanel Grid.Row="1"
                        Grid.Column="1"
                        HorizontalAlignment="Left"
                        MaxWidth="400"
                        Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=0-5}">
                <TextBlock Text="{Binding PackagingErrorMessage}"
                           Foreground="Red"
                           TextWrapping="Wrap"
                           Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
                <Button Content="View logs for full details"
                        Foreground="Red"
                        Command="{Binding ViewLogsCommand}"
                        Style="{StaticResource HyperlinkUnderlinedButtonStyle}"
                        Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </StackPanel>
            <!-- Row 2 (leaves empty row for error message) -->
            <Grid Grid.Row="2"
                  Grid.Column="0"
                  Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=6-93}"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Height="16"
                  Width="16"
                  Margin="0, 30, 0, 0">
                <Image Source="/Resources/AppIcon/Settings.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}">
                    <Image.RenderTransform>
                        <RotateTransform CenterX="8" CenterY="8" />
                    </Image.RenderTransform>
                    <Image.Triggers>
                        <EventTrigger RoutedEvent="Image.Loaded">
                            <BeginStoryboard Storyboard="{StaticResource RotateAnimation}" />
                        </EventTrigger>
                    </Image.Triggers>
                </Image>
                <Image Source="/Resources/AppIcon/ErrorIcon.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </Grid>
            <Image Grid.Row="2"
                   Grid.Column="0"
                   Source="/Resources/AppIcon/Accept.png"
                   Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=94-100}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Top"
                   Height="16"
                   Width="16"
                   Margin="0, 30, 0, 0"/>
            <TextBlock Grid.Row="2" Grid.Column="1"
                       Text="Copying and encrypting data..."
                       Foreground="White"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       Margin="0, 30, 0, 0"/>
            <StackPanel Grid.Row="3"
                        Grid.Column="1"
                        HorizontalAlignment="Left"
                        MaxWidth="400"
                        Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=6-93}">
                <TextBlock Text="{Binding PackagingErrorMessage}"
                           Foreground="Red"
                           TextWrapping="Wrap"
                           Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
                <Button Content="View logs for full details"
                        Foreground="Red"
                        Command="{Binding ViewLogsCommand}"
                        Style="{StaticResource HyperlinkUnderlinedButtonStyle}"
                        Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </StackPanel>
            <!-- Row 3 (now two empty rows for error messages) -->
            <Grid Grid.Row="4"
                  Grid.Column="0"
                  Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=95-99}"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Height="16"
                  Width="16"
                  Margin="0, 30, 0, 0">
                <Image Source="/Resources/AppIcon/Settings.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}">
                    <Image.RenderTransform>
                        <RotateTransform CenterX="8" CenterY="8" />
                    </Image.RenderTransform>
                    <Image.Triggers>
                        <EventTrigger RoutedEvent="Image.Loaded">
                            <BeginStoryboard Storyboard="{StaticResource RotateAnimation}" />
                        </EventTrigger>
                    </Image.Triggers>
                </Image>
                <Image Source="/Resources/AppIcon/ErrorIcon.png"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </Grid>
            <Image Grid.Row="4"
                   Grid.Column="0"
                   Source="/Resources/AppIcon/Accept.png"
                   Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=100-100}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Top"
                   Height="16"
                   Width="16"
                   Margin="0, 30, 0, 0"/>
            <TextBlock Grid.Row="4"
                       Grid.Column="1"
                       Text="Verifying package contents..."
                       Foreground="White"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       Margin="0, 30, 0, 0"/>
            <StackPanel Grid.Row="5"
                        Grid.Column="1"
                        Visibility="{Binding PackingProgressPercentage, Converter={StaticResource ProgressToVisibilityConverter}, ConverterParameter=95-99}">
            <TextBlock Text="{Binding PackagingErrorMessage}"
                       Foreground="Red"
                       HorizontalAlignment="Left"
                       MaxWidth="400"
                       TextWrapping="Wrap"
                       Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
                <Button Content="View logs for full details"
                        Foreground="Red"
                        Command="{Binding ViewLogsCommand}"
                        Style="{StaticResource HyperlinkUnderlinedButtonStyle}"
                        Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
            </StackPanel>
        </Grid>
        <StackPanel Grid.Row="6"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}">
            <Button Content="Cancel packaging"
                    Command="{Binding CancelCreationCommand}"
                    IsEnabled="True"
                    Margin="0, 0, 50, 50"
                    Width="150"
                    Height="30"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"/>
        </StackPanel>
        <StackPanel Grid.Row="6"
                    Orientation="Horizontal"
                    HorizontalAlignment="Left"
                    Visibility="{Binding PackagingErrorMessage, Converter={StaticResource StringNotEmptyToVisibilityConverter}}">
            <Button Content="Back"
                    Command="{Binding CancelCreationCommand}"
                    IsEnabled="True"
                    Margin="50, 0, 50, 50"
                    Width="150"
                    Height="30"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"/>
        </StackPanel>
    </Grid>

</UserControl>